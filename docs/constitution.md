# Project Constitution

## 1. Purpose

To ensure **Voice Box** remains a lean, privacy-focused tool for local AI voice synthesis, strictly adhering to the "Script-to-Audio" workflow defined in the PRD. This constitution prevents feature creep (e.g., turning into a full DAW) and enforces technical stability.

## 2. Non-Negotiables

* **Privacy First:** No audio data or script text may leave the local machine. All processing is local.
* **Platform Priority:** Linux (Pop!_OS) is the primary citizen. Windows/Mac support must not break Linux functionality.
* **Performance:** The UI thread (Dioxus) MUST NEVER block on network requests or heavy computation. All synthesis and downloads must be async.
* **Data Integrity:** Source audio clips (references) must never be overwritten/deleted without explicit user confirmation.

## 3. Spec-Kit Workflow Gates

To merge code, you must pass these gates in order:

1. **Specify:** Create a Markdown spec in `specs/` describing the feature.
2. **Plan:** Update `SPECS.md` and link the spec to the Roadmap.
3. **Tasks:** Break down the spec into checkboxes.
4. **Implement:** Write code only after the spec is approved/finalized.
   *Rule:* **No Code Without Specs.**

## 4. Quality Bars

* **Testing:**
  * Rust: `cargo test` must pass for all core logic (parsers, state management).
  * Python: Unit tests for API endpoints (mocking the GPU inference).
* **Documentation:**
  * All public Rust structs/functions must have doc comments (`///`).
  * Python API must have Swagger/OpenAPI docs (auto-generated by FastAPI).
* **Error Handling:**
  * UI must display user-friendly errors for: Backend offline, YouTube download failure, Invalid audio format.
  * App must not crash on backend failures.

## 5. Security and Privacy

* **Local Only:** No telemetry, no analytics, no external API calls (except YouTube download).
* **Input Validation:** Sanitize all YouTube URLs before passing to `yt-dlp`.

## 6. Definition of Done (DoD)

A feature is Done when:

* [ ] Spec document exists and is accurate.
* [ ] Code implements all functional requirements.
* [ ] `cargo test` passes.
* [ ] UI handles loading and error states.
* [ ] Works on Pop!_OS (Linux).

## 7. Change Control

This constitution is stable. Modifications require a dedicated "Constitution Amendment" spec explaining the rationale and impact on the MVP.
